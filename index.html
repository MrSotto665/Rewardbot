<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Secret Meet - Premium Chat</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --primary: #ff0080;
            --secondary: #7928ca;
            --bg-dark: #0a0b1e;
            --glass: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --text-muted: #a0a0b8;
        }

        body { 
            background: radial-gradient(circle at top right, #1a1b3a, #0a0b1e); 
            color: var(--text-main); 
            font-family: 'Inter', -apple-system, sans-serif; 
            margin: 0; 
            overflow: hidden; 
            height: 100vh;
        }

        #app { display: flex; flex-direction: column; height: 100vh; }

        .header { 
            background: rgba(15, 12, 41, 0.8);
            backdrop-filter: blur(15px);
            padding: 18px; 
            text-align: center; 
            font-size: 1.1rem;
            font-weight: 800; 
            border-bottom: 1px solid rgba(255, 0, 128, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        #home-screen { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            padding: 30px;
            animation: fadeIn 0.8s ease;
        }

        .hero-icon {
            font-size: 60px;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 15px var(--primary));
        }

        .btn-main { 
            padding: 16px 50px; 
            border-radius: 30px; 
            border: none; 
            background: linear-gradient(135deg, var(--primary), var(--secondary)); 
            color: white; 
            font-size: 17px; 
            font-weight: 700; 
            cursor: pointer; 
            transition: 0.3s;
            box-shadow: 0 8px 25px rgba(255, 0, 128, 0.4);
            margin-top: 20px;
        }

        #chat-screen { flex: 1; display: none; flex-direction: column; position: relative; }
        
        #messages { 
            flex: 1; 
            overflow-y: auto; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 12px;
        }

        .msg { 
            padding: 12px 18px; 
            border-radius: 18px; 
            max-width: 80%; 
            font-size: 15px; 
            line-height: 1.5; 
            animation: slideUp 0.3s ease;
        }
        .me { background: linear-gradient(135deg, var(--primary), var(--secondary)); align-self: flex-end; border-bottom-right-radius: 4px; }
        .partner { background: var(--glass); backdrop-filter: blur(10px); align-self: flex-start; border-bottom-left-radius: 4px; }

        .input-area { 
            padding: 15px; 
            background: rgba(10, 11, 30, 0.9);
            display: flex; 
            gap: 10px;
            border-top: 1px solid rgba(255,255,255,0.05);
        }
        input { 
            flex: 1; padding: 12px 20px; border-radius: 25px; 
            border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); 
            color: white; outline: none;
        }

        .send-btn { background: var(--primary); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        .stop-chat { color: #ff4d4d; font-size: 13px; font-weight: 600; padding: 10px; background: transparent; border: none; cursor: pointer; }

        .end-options { 
            display: flex; flex-direction: column; gap: 12px;
            padding: 25px; background: var(--glass); 
            backdrop-filter: blur(20px); border-radius: 20px; 
            margin: 20px; border: 1px solid rgba(255, 0, 128, 0.2);
            animation: slideUp 0.4s ease;
        }
        .btn-next { background: #00d2ad; color: white; border: none; padding: 14px; border-radius: 15px; font-weight: 700; cursor: pointer; }
        .btn-exit { background: rgba(255, 255, 255, 0.1); color: white; border: none; padding: 14px; border-radius: 15px; font-weight: 700; cursor: pointer; }

        .status-msg { font-size: 12px; color: var(--text-muted); text-align: center; margin: 10px 0; font-style: italic; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10375834' data-sdk='show_10375834'></script>
</head>
<body>
    <div id="app">
        <div class="header"><span>üíñ</span> SECRET MEET LIVE</div>
        
        <div id="home-screen">
            <div class="hero-icon">üé≠</div>
            <h1>Ready to Mingle?</h1>
            <p style="color: var(--text-muted); text-align: center;">Connect anonymously with random people.</p>
            <button class="btn-main" id="findBtn" onclick="findPartner()">üîç Start Searching</button>
            <p id="status-text" style="margin-top: 20px; font-size: 14px; color: var(--primary);">‚óè Online & Ready</p>
        </div>

        <div id="chat-screen">
            <div id="messages"></div>
            <div style="text-align: center;" id="stop-btn-container">
                <button class="stop-chat" onclick="endChatLocal()">Disconnect Chat</button>
            </div>
            <div class="input-area" id="input-container">
                <input id="minput" type="text" placeholder="Write a message..." onkeypress="if(event.key==='Enter') sendMsg()">
                <button class="send-btn" onclick="sendMsg()">‚û§</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const socket = io({ transports: ['websocket'], upgrade: false });
        const userId = tg.initDataUnsafe?.user?.id;
        //Ads agram tags
        const AdController = window.Adsgram.init({ blockId: "int-19991" });

        tg.expand();
        tg.ready();

        if (userId) socket.emit('join', userId);

       function findPartner() {
    if (!userId) return;

    // 1. Prothome Ad dekhabe
    AdController.show().then((result) => {
        // 2. Ad successfully dekha hole ba close korle searching shuru hobe
        startSearchingLogic();
    }).catch((result) => {
        // 3. Jodi kono error hoy (ad load na hoy), tobeo searching shuru hobe 
        // jate user stuck hoye na thake
        console.error("Ad error:", result);
        startSearchingLogic();
    });
}

// Main searching logic ti alada ekta function-e niye asha hoyeche
function startSearchingLogic() {
    document.getElementById('status-text').innerText = "‚ö° Searching...";
    document.getElementById('findBtn').disabled = true;
    document.getElementById('findBtn').style.opacity = "0.5";
    socket.emit('find_partner_web', userId); 
}

        socket.on('match_found', () => {
            document.getElementById('input-container').style.display = 'flex';
            document.getElementById('stop-btn-container').style.display = 'block';
            document.getElementById('home-screen').style.display = 'none';
            document.getElementById('chat-screen').style.display = 'flex';
            document.getElementById('messages').innerHTML = "";
            addStatusMessage("‚ú® Match found! Say hello.");
        });

        function sendMsg() {
            const inp = document.getElementById('minput');
            if (!inp.value.trim()) return;
            addMessage(inp.value, 'me');
            socket.emit('send_msg', { senderId: userId, text: inp.value });
            inp.value = '';
        }

        socket.on('receive_msg', (data) => {
            addMessage(data.text, 'partner');
            tg.HapticFeedback.notificationOccurred('success');
        });

        socket.on('chat_ended', () => {
            addStatusMessage("üö´ Partner left the chat.");
            showEndControls();
        });

        function endChatLocal() {
            addStatusMessage("üîí You closed the chat.");
            if (userId) socket.emit('leave_chat', userId);
            showEndControls();
        }

        function showEndControls() {
            document.getElementById('input-container').style.display = 'none';
            document.getElementById('stop-btn-container').style.display = 'none';
            
            const old = document.getElementById('end-options-ui');
            if(old) old.remove();

            const controlDiv = document.createElement('div');
            controlDiv.className = 'end-options';
            controlDiv.id = 'end-options-ui';
            controlDiv.innerHTML = `
                <button class="btn-next" onclick="findNextPartner()">üîç Find Next Person</button>
                <button class="btn-exit" onclick="location.reload()">üè† Return Home</button>
            `;
            document.getElementById('messages').appendChild(controlDiv);
            scrollDown();
        }

        function findNextPartner() {
            if (userId) socket.emit('leave_chat', userId); 
            document.getElementById('chat-screen').style.display = 'none';
            document.getElementById('home-screen').style.display = 'flex';
            document.getElementById('findBtn').disabled = false;
            document.getElementById('findBtn').style.opacity = "1";
            
            setTimeout(() => { findPartner(); }, 300);
        }

        function addMessage(text, type) {
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            div.innerText = text;
            document.getElementById('messages').appendChild(div);
            scrollDown();
        }

        function addStatusMessage(text) {
            const p = document.createElement('p');
            p.className = 'status-msg';
            p.innerText = text;
            document.getElementById('messages').appendChild(p);
            scrollDown();
        }

        function scrollDown() {
            const container = document.getElementById('messages');
            container.scrollTop = container.scrollHeight;
        }
        

// In-App Interstitial

show_10375834({
  type: 'inApp',
  inAppSettings: {
    frequency: 2,
    capping: 0.1,
    interval: 30,
    timeout: 5,
    everyPage: false
  }
})

/*
This value is decoded as follows:
- show automatically 2 ads
  within 0.1 hours (6 minutes)
  with a 30-second interval between them
  and a 5-second delay before the first one is shown.
  The last digit, 0, means that the session will be saved when you navigate between pages.
  If you set the last digit as 1, then at any transition between pages,
  the session will be reset, and the ads will start again.
*/
// ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶™‡¶™‡¶Ü‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
socket.on('limit_over', () => {
    document.getElementById('status-text').innerText = "‚ùå Limit Over! Check Bot.";
    document.getElementById('findBtn').disabled = false;
    document.getElementById('findBtn').style.opacity = "1";
    
    // ‡¶™‡¶™‡¶Ü‡¶™ ‡¶°‡¶ø‡¶∏‡¶™‡ßç‡¶≤‡ßá ‡¶ï‡¶∞‡¶æ
    const modal = document.getElementById('limit-modal');
    modal.style.display = 'flex';
});

// ‡¶™‡¶™‡¶Ü‡¶™ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function closeLimitModal() {
    document.getElementById('limit-modal').style.display = 'none';
}

    </script>
    
    <div id="limit-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); backdrop-filter:blur(8px); z-index:9999; align-items:center; justify-content:center;">
    <div style="background:linear-gradient(135deg, #1a1b3a, #0a0b1e); border: 1px solid var(--primary); padding:30px; border-radius:25px; width:80%; max-width:320px; text-align:center; box-shadow:0 0 30px rgba(255, 0, 128, 0.3); animation: slideUp 0.4s ease;">
        <div style="font-size:50px; margin-bottom:15px;">üö´</div>
        <h2 style="margin:0; color:var(--primary); font-size:22px;">Limit Reached!</h2>
        <p style="color:var(--text-muted); font-size:14px; margin:15px 0;">Your match limit is over. Check our Telegram bot to get more matches by inviting friends.</p>
        <button onclick="closeLimitModal()" style="background:linear-gradient(135deg, var(--primary), var(--secondary)); color:white; border:none; padding:12px 30px; border-radius:15px; font-weight:700; cursor:pointer; width:100%;">Got it!</button>
    </div>
</div>
</body>
</html>
